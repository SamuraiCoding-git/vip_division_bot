import asyncio

import time

from aiogram import Router, F, Bot
from aiogram.fsm.context import FSMContext
from aiogram.types import CallbackQuery, InlineKeyboardMarkup, InlineKeyboardButton, Message

from infrastructure.api.app import config
from tgbot.config import Config
from tgbot.filters.private import IsPrivateFilter
from tgbot.keyboards.callback_data import ReadingCallbackData
from tgbot.keyboards.inline import guide_keyboard, guides_keyboard, \
    community_keyboard, generate_keyboard
from tgbot.utils.db_utils import get_repo
from tgbot.utils.message_utils import delete_messages, handle_seduction_deeplink

user_router = Router()

user_router.message.filter(IsPrivateFilter())
user_router.callback_query.filter(IsPrivateFilter())


# @user_router.message()
# async def message_mailing(message: Message, config: Config, bot: Bot):
#     if message.from_user.id != 422999166:
#         return
#
#     users = list(set([422999166, 787633431, 565962178, 1880444600, 6717092735, 392037997, 571244961, 1841411827, 1101385842, 810093188, 802847098, 337978330, 98120898, 5141134854, 23851, 677463572, 602290019, 1082511910, 653512499, 6309026545, 982646219, 5204061552, 200462902, 5116358235, 2022680390, 449278605, 1117627393, 195537780, 1447055496, 7680773015, 883117536, 1606001967, 1061416445, 6855862723, 263406856, 463068070, 141794264, 489133844, 1116133322, 682927633, 1446298199, 6460529932, 6023168149, 5078158122, 792555431, 486946664, 815507166, 7663311990, 5088837806, 721699249, 5392839995, 601552792, 1068966350, 7635073314, 932252429, 7487688298, 345484570, 667681533, 6257228359, 1022847524, 526406632, 422571843, 1568902338, 1053414381, 545011623, 1884616116, 829433504, 6292274553, 5755603332, 816082306, 410468918, 1471883358, 490586506, 783603832, 627989001, 6222991850, 1972609095, 1251290581, 1708284971, 1156516396, 5952961326, 1087968824, 573566347, 7750382165, 163869778, 536436899, 1162631672, 717023035, 203890682, 5905786625, 439626377, 122740835, 1518043685, 1291846143, 5684331720, 1358861484, 557236183, 490152944, 6605179411, 1123181212, 2023814625, 1777311166, 7665450308, 1633920071, 2096968064, 382631025, 5663738078, 931702424, 442994965, 332371391, 737421237, 969335637, 672316873, 451012806, 1052562218, 490391341, 1146297985, 1061241850, 200310027, 1039439551, 1902691188, 429849277, 5343590992, 314958446, 6845004210, 7807743820, 539207601, 790920964, 5656991134, 7132313389, 1427482815, 886790749, 1152574732, 6442399446, 768560320, 5663197510, 6162902351, 1849621257, 1044945913, 732988210, 1805506764, 841785920, 523037543, 6922651876, 850129830, 1385124223, 6096648133, 535609496, 7650636204, 645889535, 2142707545, 887927373, 7002392786, 5354558979, 302916369, 6728828986, 1250464361, 730319997, 419616198, 1854634412, 1706850273, 583728158, 797639553, 470863831, 223204204, 550032799, 916226635, 1354404515, 6801831812, 5358020502, 878843680, 789007278, 1394441886, 319533233, 570470972, 1416898147, 691960814, 223980793, 88832741, 1653197002, 7614999426, 387711076, 399619230, 941439656, 699670932, 817333753, 821892126, 435032945, 1673245640, 5060221423, 292332533, 450059004, 5518768682, 5487504473, 1959735643, 313838893, 1292233288, 962217545, 1792392355, 1129233479, 853745491, 510130256, 7342691394, 1633221784, 524350504, 395156085, 556216336, 7938961690, 270903740, 145697094, 121778188, 666295005, 741324088, 6187374743, 943264808, 395750017, 463953058, 1361264894, 439592022, 6850097694, 393802904, 5174599044, 2056620746, 742075521, 648192419, 1388790011, 626973911, 5334636406, 504440552, 1187357827, 2111735943, 347177561, 7029258539, 316142133, 959531286, 782290296, 509305598, 507127737, 7833168206, 708854995, 431905037, 6665744691, 826550459, 557133243, 679842772, 300966393, 1014620990, 879836118, 5409546118, 5258908474, 7467400440, 5947443856, 684141045, 5742305351, 2130074295, 6975929078, 5843065138, 660519880, 6109404597, 1009520641, 1160265139, 178579574, 5460673739, 7510203893, 877770537, 1711424749, 881814257, 783760708, 5600948136, 5999381025, 5187619267, 1236290139, 1721548879, 6770307840, 832998528, 6952616680, 6947050675, 627039752, 629630994, 1767580438, 1611332726, 214519440, 223368735, 899860958, 1605602372, 605858565, 639962258, 1622669774, 512522346, 5491251321, 1807909364, 5141781013, 150347606, 733083475, 284996582, 1707344252, 524742046, 617353619, 1698640134, 133884536, 5054240290, 634708771, 561411874, 1168240583, 477946771, 611711338, 926547243, 124835129, 1086923996, 841591727, 300631545, 560552256, 433409713, 603440175, 356439413, 425699097, 863243416, 6745486993, 1803121784, 7931138225, 6705957283, 1485398262, 5834517014, 718433524, 381748452, 470267531, 501170286, 1972127644, 2037890027, 880563595, 6689042409, 1100465273, 929980615, 740942144, 1044816958, 6913807324, 6761762861, 753266738, 5918796177, 717445217, 304685913, 582019971, 191557472, 7696060209, 386840243, 7113437395, 1010648313, 156606037, 5144732379, 821642438, 534555054, 1290077690, 1919587305, 1076159926, 7890175058, 5158786285, 569190896, 737660153, 585651242, 1197364227, 1252576990, 6395206864, 1034623202, 1189075495, 1401109140, 1524097535, 809050874, 637843277, 481388160, 548770519, 2078654412, 939171819, 300001831, 1228611429, 466162098, 5629369759, 5842712511, 460558358, 569762292, 528358524, 467830365, 1390786944, 5420659178, 568559341, 716293833, 530978981, 1009029448, 919883593, 376934311, 472907671, 497739277, 1920364845, 799867691, 1397559787, 1055542433, 1065912726, 756158284, 1030550480, 638133501, 796822916, 5294530966, 1855520400, 297113632, 626497998, 284278378, 607551415, 1054094752, 1619102215, 67039018, 952670170, 669393820, 877746856, 5209639700, 925458790, 507337928, 1048721214, 764491842, 476837306, 564973155, 969956069, 1348325874, 297883506, 1432808984, 2090884240, 1802000506, 991499668, 209431432, 648493069, 626317737, 7463923822, 5127559907, 969596882, 1206907306, 6575324750, 1590636714, 5207680830, 7892317610, 5766954022, 405768132, 533852343, 2008904740, 5248615150, 6818967843, 342872327, 5180825547, 5924904302, 697620525, 7447725201, 420451714, 702200125, 5546670738, 1088314495, 1493112384, 677227145, 1010213057, 472338272, 397453163, 839689397, 1892463388, 741707961, 918730704, 5266444517, 661654412, 2045018372, 769486187, 1836579562, 696724040, 783148938, 7186937838, 6969682027, 575645003, 1161080635, 869804503, 418264878, 6598842724, 2079915716, 1414087398, 6182322839, 604147607, 1098917598, 1661979116, 970941047, 570780360, 5765425486, 7562889692, 446156592, 1967677456, 5703119107, 35943473, 6937468216, 1036291926, 436681356, 490431851, 881561560, 6117054034, 6540274257, 252303413, 864270651, 719806618, 1094538495, 1304077717, 5321425281, 182029344, 886549456, 262088873, 2143308166, 7158190698, 624547010, 1510887632, 6582849064, 8046475679, 6630857417, 1249924540, 2006905652, 5760317174, 316608438, 5817993656, 801084697, 737650344, 668466313, 391691112, 819947730, 1040368239, 545746363, 1965434519, 622177019, 398343051, 7371631705, 737185364, 1450650925, 1184250157, 770449936, 1034468507, 709631685, 1213851827, 611074557, 928271883, 6719055705, 999940909, 5043758362, 656739215, 549390102, 7771122106, 5798716541, 926627288, 6029178542, 336382466, 6887522903, 671008755, 5313943932, 490004181, 553799287, 494613532, 6839720618, 803626739, 5656502112, 6904590653, 1358535014, 1052858236, 5142561537, 5881447771, 619704003, 863464444, 1887506186, 6986510681, 462869902, 855852041, 1279409475, 778385680, 7268922562, 1277189972, 354408997, 82755888, 5030491431, 314852418, 1070830452, 320519455, 857300222, 305764087, 1681185795, 5410072396, 1035791847, 5723811941, 333799934, 500084873, 662430493, 1101308107, 1021624484, 463549082, 838917639, 859051711, 847086192, 333059753, 867295988, 6128935449, 7364289180, 1002309032, 503090635, 1662472816, 381675352, 5594178407, 6501137340, 7488679555, 6382886439, 5223916439, 35120469, 200409328, 213361239, 214303205, 1369830053, 1624170020, 526597526, 901260242, 1329142502, 1947076798, 887744567, 1400794133, 6346325388, 202526881, 1434266665, 1881757979, 447759763, 836958299, 1223120415, 626526347, 211729179, 262770846, 634345945, 479916990, 696847452, 1029868865, 389646953, 645616918, 816485395, 863069196, 691940711, 603527746, 136383866, 1635232891, 7057954606, 7657854638, 1670288099, 815340808, 1680369914, 5735376375, 5328954254, 1376244259, 5900412442, 2096650005, 495433347, 1924554535, 920257751, 613346324, 7278228685, 5093611209, 870102377, 5955906616, 557184390, 212019533, 986170085, 349742173, 5855928053, 2133751805, 555462490, 8113399271, 7575978244, 797396685, 763084333, 918645498, 1526627657, 1088017166, 1123876396, 1403888180, 7055709325, 255361215, 1875246991, 152547361, 1589164087, 6103974709, 1131883717, 5445603514, 7643537104, 5819816668, 5795431866, 818717849, 1138901594, 752530573, 2062761560, 629149507, 250299672, 308466867, 1871224945, 293485001, 6768255543, 719817462, 456393195, 722929884, 1238919686, 925291301, 300661274, 961356834, 5180669860, 447075493, 933429519, 1970809214, 670874961, 286212333, 338773267, 555040472, 215037305, 452976413, 576586907, 272143398, 1225793898, 5742017521, 462756414, 966104286, 444900762, 696167575, 1179135420, 602026320, 1732923193, 5825307709, 1156710889, 425460858, 721369477, 2114724985, 553500381, 790841060, 857061955, 5026819825, 331359462, 333707443, 5348213192, 409680549, 5199642561, 695406699, 991410110, 858008867, 7366023131, 7051463039, 536560931, 6105841385, 558440518, 685788756, 7246509675, 5543968102, 7179071149, 661028872, 1956339185, 6605138464, 5525588137, 1373753953, 6592700477, 527849570, 7633995567, 1701906714, 6044052068, 1208902139, 423581912, 1869616967, 858395023, 580104527, 7621510575, 5700347792, 159767395, 565344457, 1014550859, 1132425265, 1131883753, 390863215, 544563275, 519772243, 1154722093, 601393512, 5904316590, 76226882, 835008292, 568774908, 788623819, 255209574, 455728261, 406402483, 1384116960, 547723369, 1921159202, 6766291704, 200628805, 1769138820, 6188747117, 76435741, 526059909, 886380632, 762062412, 854777028, 1422575313, 6468810347, 453495918, 1393634053, 1557754231, 734493974, 625886721, 214060451, 865709024, 523665839, 721700152, 933266164, 105853990, 6613990739, 6610650007, 274824956, 6879615858, 395279953, 7762522671, 2012896408, 1492117982, 208198615, 837019578, 528323666, 290039998, 1130303664, 441776226, 1859793073, 2029331901, 202027212, 128732116, 1179293115, 325440512, 825092931, 183852710, 1825522662, 973224120, 836235221, 5904728062, 2062759747, 1719215138, 6270928329, 728586759, 1532055923, 450630298, 853124017, 1759173911, 249979054, 5165002051, 801732232, 578479581, 1437245704, 5736645008, 658716947, 254317907, 501214898, 1194388438, 435600486, 526232881, 202122306, 508007105, 1860986451, 5534957948, 5211890986, 5454465037, 426468578, 1453837799, 842287010, 1112424311, 609296538, 1036440868, 417417312, 477057796, 1418635910, 5262084843, 7702991600, 114002631, 1104141124, 880788198, 1362361802, 1991474032, 5987915737, 5917355270, 6960386305, 321532745, 6331762214, 2108192983, 841528909, 632685183, 1311033664, 1119018895, 2115113608, 467661526, 740323775, 1989805073, 741419553, 1069729134, 281495603, 5917017434, 1553551805, 134085364, 834148435, 1087613347, 7125325162, 6866611477, 5406364429, 5010580147, 292155803, 728817729, 1345827027, 806014280, 1686202008, 6934773704, 308659687, 1061092138, 738286745, 5606736158, 791320778, 1639791011, 7853348493, 427207384, 6055118445, 5451969563, 66012796, 445101734, 841181183, 1790439398, 5473528106, 6861892621, 652274748, 6764950783, 940877493, 1268509061, 490905834, 1632342627, 1302191522, 1149583794, 5762677119, 7361972792, 433245710, 755807815, 552447870, 490590246, 6234064521, 557414423, 1612504008, 5803619861, 1313342505, 678773538, 433472608, 518969732, 580838226, 939972870, 442141956, 6792893763, 7055306641, 399768008, 997315333, 678144546, 658238854, 742977782, 313581812, 1733407566, 7643744048, 860043624, 736364884, 1165421876, 326894292, 261866397, 1326431271, 5358894206, 393527624, 781361102, 425651501, 1592039725, 565742551, 5521078926, 5257011430, 1040832613, 496310049, 816730281, 481760413, 5050201343, 7607382561, 742603275, 895587762, 661125620, 6038488107, 590853159, 6313176775, 942780784, 799900543, 1542869987, 367761479, 359862233, 335184610, 6342480328, 870373039, 5415662204, 1644799566, 1704799878, 1297632707, 96843230, 1634897402, 5359209137, 7410509900, 1320829167, 1015639748, 6793137278, 610487842, 1262304416, 5929445639, 924094064, 5014954324, 214704065, 1053424826, 961699028, 822814899, 450260254, 1033762416, 1485161250, 881503345, 1067105550, 492218421, 5674514157, 1403110918, 1691567105, 88317796, 7931300595, 504052325, 1219706003, 679190627, 1082877344, 6669421959, 819107198, 5493535154, 6687089455, 5416639792, 7823706902, 699415596, 196651604, 1034884826, 789383110, 258163765, 894163234, 6430312838, 296646518, 508682114, 995409350, 628759274, 5106895746, 445058905, 529007380, 653233193, 6536801126, 969167290, 1430058311, 846562955, 7335575740, 1272325998, 1029280866, 594921650, 150819719, 1558356019, 360759506, 7976260590, 525041691, 337095995, 536883025, 5838710533, 193888581, 255058256, 460475295, 68327585, 783931465, 579978530, 1066371425, 944651033, 1489372188, 997343119, 6011828157, 6822836501, 821212926, 1177629505, 1334322444, 539215070, 870364373, 5987797384, 5170215424, 5017456943, 657982965, 1140525674, 506186446, 962460474, 839207246, 499004452, 1042710336, 880923262, 539169585, 837570567, 6810846328, 509494171, 1004210195, 1465988414, 5394640502, 352440476, 571527839, 666252354, 1300779760, 939872541, 352704753, 7179169522, 990423060, 6304992506, 5409281459, 1326977751, 685058319, 780044372, 5977646754, 1964421809, 769790476, 1423349800, 6072302634, 425849872, 5046785482, 444429144, 119322481, 1566046069, 29459343, 819181118, 1131540814, 5392079477, 5535429001, 417396381, 393835139, 211685138, 107875406, 6704458870, 5448676476, 1051700762, 774095726, 554581971, 890536700, 263796747, 405747648, 908377937, 7192031064, 1381041326, 6236144261, 1635899279, 746378241, 772574406, 544864711, 1760198104, 990512289, 7919994338, 1695459201, 807636716, 423392957, 6876667335, 1025096464, 5400481480, 5736167904, 422944540, 1090860655, 399038777, 846331042, 904064128, 483502835, 59125487, 5518768789, 2107838004, 351287856, 1296675126, 651434033, 515107102, 383737868, 103783778, 6191906387, 1055508779, 707408, 738366577, 1713044983, 383710033, 5545324904, 1784981709, 346085157, 1452866276, 5052464958, 6695296997, 511255718, 1022840993, 718282100, 7009211673, 1058056895, 999435507, 5684060080, 727706913, 451612013, 1282918582, 362066395, 758092985, 1224342370, 392147008, 5401361734, 7575515548, 623026986, 1859654483, 798627860, 567391179, 7024954629, 6141606773, 996760170, 362322656, 1588537841, 564300859, 535279017, 7817089583, 736534497, 1213957237, 7837197893, 5642609337, 5965498157, 74887778, 1064828056, 717896134, 884310192, 530351293, 729464723, 1542361885, 108445094, 7098498797, 810957893, 644934873, 5959644301, 1488408179, 1863654259, 501549295, 1065616315, 1404551063, 482203399, 6740086822, 795953595, 209760181, 6627056148, 728285292, 1004388965, 1100407851, 934877327, 288677295, 443685322, 793707974, 310453120, 5868072430, 5894608985, 1366455884, 780302615, 7460704032, 272760102, 6390056688, 393798962, 821390305, 5648107246, 590642591, 6406761058, 6956781469, 416802769, 5533609669, 1127530798, 1541832935, 616056979, 7453917150, 256333521, 6391797672, 6570294518, 644081975, 5038663995, 741116969, 8153406366, 744514497, 5512689611, 792950484, 150809978, 6800775361, 489608481, 2023963769, 5569119580, 1202848547, 1050251371, 983763265, 674952226, 532078713, 6094059775, 1645366150, 1163285565, 1097380329, 424469695, 7777023671, 880676246, 5071163907, 258961040, 649254555, 535684055, 446344528, 855295138, 717240923, 7664291536, 1556482759, 5987777058, 1452787879, 1723565825, 1175279256, 7079251563, 5218598770, 7362964652, 290214900, 7745851732, 1645485229, 1481538113, 385625992, 738501868, 5595510809, 651652377, 7882630800, 2143478347, 267197004, 476002913, 913561668, 6968492661, 6962457159, 8097361778, 468470082, 776435395, 6160295898, 5705693313, 280463488, 319511806, 787955380, 1092701050, 476004313, 885307322, 6111404716, 742224374, 1602904524, 549868474, 5710720704, 614763716, 296247998, 704004030, 858896279, 828503530, 329637116, 6207301460, 445301523, 999337638, 1424267783, 6121906147, 800164465, 875268989, 2076659242, 7038118340, 815470158, 244284651, 5020031316, 1047718281, 1209407273, 816605173, 1819973772, 5447967032, 5891055857, 143563077, 1346134253, 5828717649, 1193618151, 8000843353, 7944553385, 1589977124, 538492140, 921643490, 1449645647, 824091608, 5256695733, 7934534759, 712399327, 6085830877, 5997283056, 700257830, 720096516, 1928423504, 1745255634, 475226463, 47887573, 717516931, 898157331, 679239856, 7327288566, 5219731206, 492955468, 5337445038, 6546404997, 347236514, 1308674624, 7538146845, 6583918934, 6044016755, 141968284, 6068055475, 883352041, 461877494, 940082007, 800174626, 357826148, 6623011432, 875892820, 412572933, 445095963, 7176511785, 7087431382, 466393117, 775023714, 6272084588, 1028369688, 6187745658, 899765256, 924072662, 5245520619, 730623199, 1036968355, 997215468, 6139456980, 5480438808, 632210648, 1304799856, 6682418882, 423604651, 971716635, 732768228, 544016838, 6794448545, 457608948, 7698364431, 392433725, 507149917, 7406415271, 1577002013, 5776905081, 530576155, 1261055020, 633818480, 850882146, 539315171, 1368070038, 526523107, 1872272375, 420698112, 372265262, 274565132, 844287653, 657874376, 1013361064, 516753753, 1759661436, 314239358, 6919444419, 7358833373, 440499705, 463614841, 263506396, 439742756, 7238977899, 7743390104, 5600076029, 1225659391, 5050230035, 894146695, 437356356, 921047950, 6284550981, 259716623, 724249070, 1057741343, 89403246, 626409462, 795853512, 706047529, 274991965, 838697730, 519544775, 604789407, 870680637, 7339532109, 6633913329, 590278617, 1653493239, 1862914854, 935134141, 355242493, 652076183, 5628215757, 819020181, 231312718, 7173273475, 251383746, 2056362312, 1079895603, 777000, 419019053, 5068602691, 889390203, 1031507458, 6252961268, 136236729, 869954376, 1855885735, 1013343418, 471713575, 399287631, 968429505, 749176013, 1047927118, 1792581160, 5983624648, 556979805, 718357220, 517182832, 1523335148, 909080596, 410264588, 884602968, 5296848420, 977695828, 268641372, 7126448256, 441272927, 700925857, 1225966574, 1293222604, 549473749, 1190896410, 529370825, 174607539, 7755278877, 5190591925, 664474206, 5473742513, 461762572, 1376753328, 6051746553, 6503144592, 1034646128, 1001268986, 6548946593, 6347619264, 887124980, 6207041275, 6583748658, 476606902, 1487027212, 330032998, 189512784, 5686658974, 815836305, 1948529992, 1025921361, 729285545, 842443196, 7427749987, 489688514, 740785965, 1474771798, 76724354, 1483131863, 278383998, 5418313485, 1684950346, 370159399, 1035091441, 247581086, 872759425, 5464159087, 1311493614, 1694542217, 426830430, 590627648, 859345241, 6317058130, 598720003, 272617864, 1632174437, 669083626, 595802488, 1215275895, 1064376931, 840641725, 6563606841, 471015695, 456152920, 514674362, 620932677, 5065712425, 822455452, 441906982, 5224831317, 1208778277, 679613416, 1956581403, 383149081, 514308152, 7442150195, 1016327899, 895280255, 347843769, 729913790, 793023303, 416657674, 686591237, 5722135756, 488876961, 310219757, 1072556630, 230518965, 258960995, 937278621, 7233187709, 7903676677, 1907484844, 533532323, 325819381, 1578988121, 753115197, 1600643248, 688488124, 857652448, 939497904, 5558461494, 931650433, 742654240, 778409118, 467531183, 5895946019, 1032989245, 347410594, 335011816, 2036714224, 474158285, 701238959, 7408151979, 5352328039, 5223293538, 1032950927, 492268402, 442960883, 355944848, 2114934853, 825534364, 1297901698, 815057508, 981498540, 589617017, 6148235776, 1415177631, 674397924, 1001457039, 5106965329, 6481503011, 980244237, 882290843, 5962719787, 383665586, 5139360221, 478416277, 332642019, 569048013, 1631400196, 5094270378, 1767373926, 123471210, 409461076, 1246242138, 1682846292, 432005213, 542658445, 7442694023, 713862903, 6793323488, 6635724346, 1394841580, 727301615, 7926443493, 5721509096, 5895144519, 810251473, 1932538677, 6487103279, 421835243, 669880250, 752975877, 7416607481, 1211850121, 42418908, 716358141, 749202013, 896867711, 994300646, 764150031, 5542774079, 1065019062, 1287295214, 465187705, 7935992433, 6684476928, 5497109136, 7162543532, 395177705, 7297214324, 729569255, 225439049, 403999357, 6704957698, 539495658, 476876130, 5887984353, 1091876243, 220055824, 1397860218, 607282023, 712399229, 1057519251, 6883879796, 541158512, 1632087930, 569972009, 472815395, 1784441280, 881312013, 789325892, 1509180106, 1468364737, 890022514, 7604348341, 712740848, 700996814, 6935529355, 7825001406, 7615798132, 535405892, 7813115651, 1726574304, 5074597096, 746082021, 602864699, 560031702, 6662242485, 579189235, 388247897, 1236575376, 377333800, 5941483475, 1047530985, 7325112512, 595898076, 27058196, 5070457187, 703996449, 1150483752, 355975612, 538953191, 5536544324, 567586911, 903316068, 7989280168, 199203797, 6909558594, 512232012, 5217030618, 1702971707, 468206965, 530129348, 7178832611, 186075636, 2088645426, 1676516028, 335944263, 350583243, 637885768, 981341245, 5324360936, 552137001, 973579462, 1579399133, 1736040523, 746364599, 6896123795, 975845019, 723315902, 404178616, 909697679, 2019472403, 471344632, 644340943, 6829315442, 7075042027, 570491718, 698756450, 1652991793, 807784643, 1015412476, 861058893, 2141312115, 315616630, 1038239733, 1420458948, 751346021, 850391202, 913848314, 5743280956, 1700204891, 1430908634, 1675500353, 569628114, 606599568, 7010039497, 438313549, 1115735738, 462707061, 422565471, 206500634, 6139089531, 6039649114, 5028656126, 6458020727, 791980174, 1936675363, 992503619, 937654801, 5587785215, 993241181, 5865661244, 6272417412, 8171652776, 5732006393, 1027870192, 1640257048, 1145452328, 923834674, 265355311, 374658837, 910505917, 241766856, 410022044, 514477020, 1226418296, 809809184, 1360457512, 647467858, 461482908, 499593343, 6432884793, 6599134075, 1575923150, 1328204, 502324132, 468653695, 437837296, 993747494, 1898334336, 200636995, 904233314, 877877618, 6583500302, 513986558, 6679655789, 651183334, 2122909643, 257730218, 5577051800, 942310060, 5917692527, 124652496, 1700405309, 422806035, 1283216764, 5223060233, 541111700, 6934084966, 705174646, 1275776525, 785770070, 6236541979, 963139203, 182325625, 1037936693, 942626215, 5602894943, 764668398, 1940212143, 5212392804, 6142805878, 867174251, 1464917613, 762095374, 245313245, 5603731269, 998626997, 5082851476, 1935964314, 1292732822, 788698603, 5191195673, 1427097738, 771896033, 5148655816, 1064236340, 825611321, 318871784, 865561097, 806414456, 1677619680, 425407638, 25148241, 5060427666, 5002600261, 379964700, 494182674, 5862139139, 597287361, 1047851305, 7091037467, 5831193678, 467071041, 700450581, 452430482, 480431809, 5864540674, 6642342509, 379379710, 599592891, 707208166, 517585695, 71092714, 1367579440, 1086269236, 432518974, 1215593833, 1358447565, 7833287990, 941587619, 5454562745, 1249846326, 5013497999, 689053917, 1381869234, 1260026034, 1008516315, 2127638132, 7690406786, 1800903319, 717101210, 1337198582, 910397188, 6523882931, 5175253726, 6753486641, 578052662, 894740415, 460374785, 5033129040, 469925876, 1125116867, 755769247, 1297720362, 6658632768, 5711796222, 358282188, 7042232051, 5476039367, 1133082542, 8075350222, 361101664, 917158877, 1089123233, 938589623, 453756805, 5871431191, 879180169, 1247949973, 2136762782, 7955355675, 253422948, 5327825920, 998702180, 1914529033, 227393704, 7163322882, 803830719, 1013844051, 396993661, 6441602926, 253308958, 736456677, 6257964760, 987235690, 744952010, 136817688, 7274748072, 965769942, 385669515, 730299048, 1945062346, 535560762, 465591762, 767556996, 1096336504, 5267880148, 6999001416, 6935961853, 791582505, 540174273, 5833606625, 1305922361, 5271634788, 458504936, 979887223, 972849348, 246075228, 1085066027, 686299902, 721186462, 485096086, 1254713066, 1027648898, 858040205, 822267566, 203258376, 6755149332, 400246361, 730456343, 2069028055, 963172788, 379066947, 901152811, 1840130736, 5060633300, 5293289422, 1071857153, 228345158, 5505162543, 2109506507, 510546850, 568665797, 6145601084, 1354006743, 1633705239, 764455369, 691466161, 7289315778, 803307112, 1427521933, 1033703140, 885534221, 5811004619, 5303670125, 476692211, 1050947287, 893839550, 1151893616, 820210496, 1487815073, 373379241, 529002731, 798140707, 5579966262, 1480209365, 6033275604, 1333722902, 587568582, 718843884, 1177192356, 1883628631, 856366475, 433661459, 474083401, 5368007516, 1300838094, 6940883082, 1005779435, 601691986, 1432286716, 7743519133, 700278858, 482344192, 1863090614, 343587753, 1913461472, 722198643, 844988970, 885461566, 239131200, 1118961486, 423207363, 438544607, 470105691, 909811268, 6266318841, 921407860, 432543872, 5095948866, 841560697, 548733902, 777294985, 569587147, 1467113374, 970087394, 283473546, 369813015, 6496782, 8048021, 30638565, 34020866, 59032490, 74025481, 85664088, 159838509, 166057510, 181380512, 212735411, 224795506, 226319498, 238783404, 243656913, 244357708, 253407407, 256839490, 267978087, 270032975, 277621870, 285969221, 291579727, 292763292, 299659518, 312572174, 314842843, 321687157, 322429615, 329197243, 338057352, 339569621, 351090444, 352896776, 359442717, 360073782, 362211931, 362318849, 368442182, 369239760, 374225864, 404235517, 410084956, 416996958, 417419980, 418532953, 426252336, 428128085, 432964547, 440776995, 442978772, 444410449, 447487431, 451030617, 454184985, 460654701, 480099020, 484648847, 494973306, 499235502, 500954864, 504464124, 506577047, 512821652, 518337534, 521035307, 521492619, 523010526, 523766748, 529308371, 531289344, 551258447, 551998410, 553637899, 560539368, 561959026, 577829238, 589851023, 602571180, 608781602, 610466519, 617814839, 622923032, 629938015, 631173819, 637262710, 641401892, 647283584, 651130099, 656118237, 658221906, 662394172, 681406458, 688169923, 694747622, 697853813, 703700685, 704949541, 705173536, 705508643, 710000375, 710621706, 714676915, 716605386, 720012997, 726180213, 727902029, 730483622, 739272966, 739840031, 747970871, 747979215, 750917800, 751664212, 756384069, 762790769, 764969166, 780673646, 791284047, 792636855, 793391258, 796512383, 807767373, 815257703, 816978493, 820204219, 820989057, 822638843, 823416389, 829695098, 830535060, 835507529, 843488705, 844225636, 850657642, 862356979, 862364235, 864965916, 875596233, 877337988, 884211919, 886105115, 889340915, 892824183, 905240578, 905773568, 906068952, 909544826, 935451110, 958420166, 967713463, 973234448, 991489614, 1020339484, 1029072283, 1053634079, 1054418874, 1058716435, 1059908739, 1061153761, 1072074842, 1076302868, 1084719004, 1096411327, 1107847963, 1138330415, 1142499162, 1147649980, 1175929232, 1183486521, 1208345715, 1227620647, 1241980788, 1252102773, 1300706829, 1302812593, 1337327777, 1342606925, 1377881555, 1387793482, 1399295439, 1403974328, 1430749602, 1438602377, 1458595499, 1470851015, 1476536194, 1479082252, 1492056451, 1545922199, 1621751197, 1635503436, 1656490604, 1770613808, 1798592120, 1830787451, 1866560466, 1890984620, 1904164361, 1910213421, 1935092863, 1949311144, 1986277317, 2020051932, 2063069261, 5025302969, 5027633339, 5028835642, 5037470015, 5082425359, 5084236987, 5101499195, 5146135147, 5280698697, 5309589132, 5329501189, 5406597128, 5421659996, 5495534622, 5543441778, 5593399210, 5627348383, 5704619545, 5742533025, 5790712680, 5830987811, 5906005286, 6028645665, 6175445834, 6189876759, 6239999764, 6285028845, 6291255513, 6330663663, 6381283321, 6405456013, 6419249058, 6424099951, 6439840918, 6462294488, 6472640310, 6500934347, 6561678755, 6672245550, 6713501997, 6790570345, 6836062333, 6896207386, 6905463307, 7191979312, 7203605509, 7322847463, 7345861437, 7400017162, 7414639909, 7440336315, 7482450647, 7495425760, 7512806351, 7928635355]))
#
#     photo = "AgACAgIAAxkBAAEBJHBnh3_9jUk_UjRzcdmW0oEyCmwazAAC8-MxG8VuQUgclQED-Tf_RgEAAwIAA3kAAzYE"
#
#     text = (
#         "Успей попасть на ведение к главному коучу за 1390\n\n"
#         "В приватном канале Рома ДЕД (главный коуч) устраивает 7-ми дневный тренинг по полному раскрытию потенциала.\n\n"
#         "Через него уже прошли 1000-чи учеников, и их результаты поражают.\n\n"
#         "Слушай гс от Романа с вводными на неделю и присоединяйся к тренингу."
#     )
#
#     keyboard = InlineKeyboardMarkup(inline_keyboard=[
#         [
#             InlineKeyboardButton(text="Слушать ГС от Деда 🔥", callback_data="ded_gs")
#         ]
#     ])
#
#     await message.answer("Рассылка началась.")
#
#     for user in users:
#         if user in [821892126, 886105115, 5755603332]:
#             continue
#
#         try:
#             await bot.send_photo(chat_id=user, photo=photo, caption=text, reply_markup=keyboard)
#         except Exception as e:
#             print(f"Ошибка при отправке пользователю {user}: {e}")
#         time.sleep(0.03)
#
#     await message.answer("Рассылка завершена")

@user_router.callback_query(F.data == "ded_gs")
async def ded_gs(call: CallbackQuery, config: Config):
    voice = 'AwACAgIAAx0CY_XjjwACCYpnhng17q2-MTUCFZeba9Vl0QHnowACG2oAAt_sOEiCPufGmhSDTzYE'

    caption = (
        "<b>#неделясдедом 1/7</b>\n"
        "Вводный подкаст от @spacerom\n\n"
        "— Поздравление от деда с наступлением Нового года\n\n"
        "— Плохие по приватке те, кто неудобен, не соглашается с малым, выбирает себя и не боится конфликта.\n\n"
        "— Обращение к новичкам\n\n"
        "— Что будет на этой неделе?\n\n"
        "Внуки, активность необходима.\n"
        "1) Реакции\n"
        "2) Комментарии\n"
        "3) Задавайте вопросы и пишите запросы"
    )

    await call.message.answer_voice(voice=voice, caption=caption, reply_markup=generate_keyboard("Купить доступ на месяц ✅"))

    await asyncio.sleep(300)

    repo = await get_repo(config)

    user = await repo.users.select_user(call.message.chat.id)

    if user.plan_id:
        photo = "AgACAgIAAxkBAAEBJF9nh38xldRlYK7FPIEvKz8WfLKexgAC7uMxG8VuQUhFxnU-PrVg3gEAAwIAA20AAzYE"

        text = (
            "Учиться у лучшего, чтобы быть лучше!\n\n"
            "Открыл продажи приватки, чтобы вы успели на неделю с Дедом.\n\n"
            "Забирай место и не упускай такую возможность за 1390 👇🏽"
        )

        await call.message.answer_photo(photo=photo, caption=text, reply_markup=generate_keyboard("Купить доступ на месяц ✅"))





@user_router.callback_query(F.data == "read_article")
async def read_article(call: CallbackQuery, state: FSMContext, config: Config):
    text = config.text.read_article_part_1
    text_part_2 = config.text.read_article_part_2
    await state.update_data(read_clicked=True)
    await call.message.answer(text)
    await call.message.answer(text_part_2, reply_markup=guides_keyboard())


@user_router.callback_query(F.data == "get_guide")
async def get_guide(call: CallbackQuery, state: FSMContext, bot: Bot):
    await state.update_data(guide_clicked=True)
    await handle_seduction_deeplink(call, state, config)


@user_router.callback_query(ReadingCallbackData.filter())
async def successful_texting(call: CallbackQuery, state: FSMContext, callback_data: ReadingCallbackData):
    await call.message.answer(callback_data.link)
    if callback_data.state:
        await state.update_data(
            {callback_data.state: True}
        )

@user_router.callback_query(F.data == "guide")
async def guide(call: CallbackQuery, state: FSMContext, bot: Bot, config: Config):
    await delete_messages(bot=bot, chat_id=call.message.chat.id, state=state)

    caption = config.text.guide_caption
    animation = config.media.guide_animation

    sent_message = await call.message.answer_animation(animation, caption=caption, reply_markup=guide_keyboard("menu"))
    await state.update_data(message_ids=[sent_message.message_id])


@user_router.callback_query(F.data == "ready_to_change")
async def ready_to_change(call: CallbackQuery, state: FSMContext):
    await state.update_data(ready_to_change_clicked=True)
    text = config.text.ready_to_change_text
    photo = config.media.ready_to_change_photo
    await call.message.answer_photo(photo, text, reply_markup=community_keyboard())
